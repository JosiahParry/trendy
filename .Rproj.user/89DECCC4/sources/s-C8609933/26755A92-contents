token_payload <- list()
token_payload$comparisonItem <- comparison_item
token_payload$category <- category
token_payload$property <- gprop

# token_payload$comparisonItem$keyword <- curl::curl_escape(token_payload$comparisonItem$keyword)

url <- URLencode(paste0(
  "https://www.google.com/trends/api/explore?property=&req=",
  jsonlite::toJSON(token_payload, auto_unbox = TRUE),
  "&tz=",tz,"&hl=", hl
))

url <- encode_keyword(url)

# if cookie_handler hasn't been set up, get the requisite cookies from Google's API
if(!exists("cookie_handler", envir = .pkgenv)){ get_api_cookies(cookie_url) }
# get the tokens etc., using the URL and the cookie_handler
widget <- curl::curl_fetch_memory(url, handle = .pkgenv[["cookie_handler"]])

stopifnot(widget$status_code == 200)

## Fix encoding issue for keywords like Ã¶sterreich"
temp <- rawToChar(widget$content)
Encoding(temp) <- "UTF-8"

myjs <- jsonlite::fromJSON(substring(temp, first = 6))

widget <- myjs$widgets